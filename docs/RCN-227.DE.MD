```
Norm
```
# RCN- 227

## DCC-Protokoll

```
Erweiterte Funktionszuordnung
```
```
Ausgabe
02. 12 .201 8
```
```
RailCommunity – Verband
der Hersteller Digitaler
Modellbahnprodukte e.V.
```
## Inhalt

1 Allgemeines ............................................................................................................................. 1

```
1.1 Zweck der Norm ........................................................................................................... 1
1.2 Begriffsdefinition .......................................................................................................... 1
1.3 Anforderungen .............................................................................................................. 2
```
2 System zur Funktionszuordnung mit CVs je Funktion ........................................................... 2

3 System zur Funktionszuordnung mit CVs je Ausgang ........................................................... 3

```
3.1 Version 1: Matrix .......................................................................................................... 3
3.2 Version 2: Funktionsnummer ....................................................................................... 3
3.3 Version 3: Funktions- oder Binärzustandsnummer ...................................................... 4
```
4 Auswahl der Funktionszuordnung .......................................................................................... 5

Anhang A: Verweise auf andere Normen .................................................................................. 6

```
A.1 Normative Verweise .................................................................................................... 6
A.2 Informative Verweise ................................................................................................... 6
```
Anhang B: Historie ..................................................................................................................... 6

## 1 Allgemeines

### 1.1 Zweck der Norm

Diese Norm beschreibt ein erweitertes System zur Funktionszuordnung zwischen den
Funktionen innerhalb des DCC-Protokolls und den Ausgängen eines Decoders. Dieses
System zur Funktionszuordnung ermöglicht eine beliebige Zuordnung zwischen bis zu 32
Funktionen zu 24 Ausgängen und trägt damit gegenüber der Zuordnung über die
Konfigurationsvariablen 33 bis 46 der gestiegenen Zahl an Funktionen Rechnung.
Gleichzeitig ist diese Funktionszuordnung so gestaltet, dass sie noch ohne spezielles
Konfigurationsprogramm beherrschbar ist.

### 1.2 Begriffsdefinition

In dieser Norm werden die Begriffe Funktion und Ausgang folgendermaßen verwendet:

Funktionen sind die im DCC-Protokoll (oder auch einem anderen Protokoll zur
Datenübertragung zur Lok) definierten Funktionen.


Ausgänge sind die vom Decoder gesteuerten Aktionen. Dabei können diese Ausgänge
physikalische Funktionsausgänge zum Ansteuern von externen Lasten sein, aber auch andere
Aktionen wie Geräusche oder Änderung des Fahrverhaltes wie z.B. beim Rangiergang
steuern.

Mit CV werden die Konfigurationsvariablen (englisch Configuration Variables) bezeichnet.

### 1.3 Anforderungen

Um diese Norm zu erfüllen muss ein Decoder das hier beschriebene System zur
Funktionszuordnung für alle über das Protokoll empfangenen Funktionen und alle Ausgänge
des Decoders unterstützen.

Es dürfen aber auch weitere Systeme zur Funktionszuordnung z.B. über die
Konfigurationsvariablen 33 bis 46 oder ein herstellerspezifisches System unterstützt werden.

Die Konfigurationsvariable 96 ist wie in [RCN225] beschrieben zu unterstützen.

## 2 System zur Funktionszuordnung mit CVs je Funktion

Um ausreichend Speicherplatz zur Verfügung zu haben, wird ein über die CVs 31 und 32
ausgewählter Block von 256 CVs verwendet, die dann über die CVs 257 bis 512 erreichbar
sind. Um Den Block für die Funktionszuordnung auszuwählen ist CV 31 auf den Wert 0 und
CV 32 auf den Wert 4 0 zu setzen.

Für jede Funktion und Richtung sind vier Bytes reserviert. D.h. für die Funktion F0 vorwärts
die CVs 257 bis 260, für F0 rückwärts die CVS 261 bis 264, für F1 vorwärts die CVs 265 bis
268, für F1 rückwärts die CVS 269 bis 272, usw.

Jedes gesetzte Bit verknüpft einen Ausgang mit einer Funktion. Die ersten drei Byte pro
Funktion und Richtung aktivieren die Ausgänge 1 bis 24, wobei Ausgang 1 von Bit 0 des
ersten Bytes und Ausgang 24 vom Bit 7 des dritten Bytes gesteuert wird. Wird ein Ausgang
über mehrere Funktionen gesteuert, so werden diese Oder-verknüpft, d.h. der Ausgang ist
aktiv wenn eine Funktion oder mehrere Funktionen diesen Ausgang ansteuert bzw. ansteuern.

Das vierte Byte pro Funktion und Richtung definiert eine Funktion, die die Aktivierung der
Ausgänge über diese Funktion und Richtung verhindert. Dabei wird die Nummer der
Funktion – also 0 für F0, 1 für F1, 2 für F2 usw. – eingetragen. Ein Wert 255 bedeutet, dass
keine Funktion die Aktivierung verhindert.


## 3 System zur Funktionszuordnung mit CVs je Ausgang

### 3.1 Version 1: Matrix

Um ausreichend Speicherplatz zur Verfügung zu haben, wird ein über die CVs 31 und 32
ausgewählter Block von 256 CVs verwendet, die dann über die CVs 257 bis 512 erreichbar
sind. Um Den Block für die Funktionszuordnung auszuwählen ist CV 31 auf den Wert 0 und
CV 32 auf den Wert 4 1 zu setzen.

Für jeden Ausgang und Fahrtrichtung sind vier Byte reserviert. D.h. für Ausgang A vorwärts
die CVs 257 bis 260, für Ausgang A rückwärts die CVS 261 bis 264, für Ausgang B vorwärts
die CVs 265 bis 268, für Ausgang B rückwärts die CVS 269 bis 272, usw.

Jedes gesetzte Bit verknüpft einen Ausgang mit einer Funktion. Dabei entsprechen die Bits 0
bis 7 des ersten Bytes den Funktionen F0 bis F7, die des zweiten Bytes F8 bis F15, die des
dritten Bytes F16 bis F23 und die des vierten Bytes F24 bis F31.

Damit kann jeder der maximal 32 Ausgänge über eine beliebige Anzahl an Funktionen
gesteuert werden. Eine Steuerung über die Binärzustände oder ein Sperren eines Ausgangs ist
hingegen nicht möglich.

### 3.2 Version 2: Funktionsnummer

Um ausreichend Speicherplatz zur Verfügung zu haben, wird ein über die CVs 31 und 32
ausgewählter Block von 256 CVs verwendet, die dann über die CVs 257 bis 512 erreichbar
sind. Um Den Block für die Funktionszuordnung auszuwählen ist CV 31 auf den Wert 0 und
CV 32 auf den Wert 42 zu setzen.

Für jeden Ausgang und Fahrtrichtung sind vier Byte reserviert. D.h. für Ausgang A vorwärts
die CVs 257 bis 260, für Ausgang A rückwärts die CVS 261 bis 264, für Ausgang B vorwärts
die CVs 265 bis 268, für Ausgang B rückwärts die CVS 269 bis 272, usw.

Jedes Byte enthält eine Funktionsnummer. Ist die Nummer größer als 28 (ggf. anzupassen auf
68) wird diese Nummer als Binärzustand interpretiert. Der Wert 255 kennzeichnet ein
inaktives Byte. Die ersten drei Byte schalten den Ausgang ein. Das vierte Byte schaltet den
Ausgang unabhängig vom Zustand anderer Funktionen aus.

Damit kann jeder der maximal 32 Ausgänge von bis zu vier Funktionen oder Binärzuständen
bis Binärzustand 254 gesteuert werden. Da keine Bitmasken zu berechnen sind, sollte dieses
System für den Anwender besonders einfach sein.

Beispiel:
Lichtsteuerung an einer Diesel- oder E-Lok. Folgende Logik soll erreicht werden:

a. "normaler" Lichtwechsel über F
b. Weil das mit Zug nicht vorbildgerecht ist: F1 sperrt die Lichter an Führerstand 1, F2 sperrt
die Lichter an Führerstand 2.
c. Der Rangiergang über F6 soll auch beide weißen Lichter ein- und die roten Lichter
ausschalten.
d. Funktion F23 soll "Parklicht" mit rot auf beiden Seiten einschalten.


Programmierung:

a) b) & c) --- d)

Ausgang weiß 1 vorw. CV257 = F0 = 0 CV258 = F6 = 6 CV259 = 255 CV260 = F1 = 1

Ausgang weiß 1 rückw. CV261 = 255 CV262 = F6 = 6 CV263 = 255 CV260 = F1 = 1

Ausgang weiß 2 vorw. CV265 = 255 CV266 = F6 = 6 CV267 = 255 CV268 = F2 = 2

Ausgang weiß 2 rückw. CV269 = F0 = 0 CV270 = F6 = 6 CV271 = 255 CV268 = F2 = 2

Ausgang rot 1 vorw. CV273 = 255 CV274 = F23 = 23 CV275 = 255 CV275 = F1 = 1

Ausgang rot 1 rückw. CV277 = F0 = 0 CV274 = F23 = 23 CV279 = 255 CV275 = F1 = 1

Ausgang rot 2 vorw. CV281 = F0 = 0 CV282 = F23 = 23 CV283 = 255 CV284 = F2 = 2

Ausgang rot 2 rückw. CV285 = 255 CV282 = F23 = 23 CV287 = 255 CV288 = F2 = 2

Problem: Für Rangiergang und "Parklicht" müssen die anderen Funktionen ausgeschaltet sein.

### 3.3 Version 3: Funktions- oder Binärzustandsnummer

Um ausreichend Speicherplatz zur Verfügung zu haben, wird ein über die CVs 31 und 32
ausgewählter Block von 256 CVs verwendet, die dann über die CVs 257 bis 512 erreichbar
sind. Um Den Block für die Funktionszuordnung auszuwählen ist CV 31 auf den Wert 0 und
CV 32 auf den Wert 4 3 zu setzen.

Für jeden Ausgang sind acht Byte reserviert. D.h. für Ausgang A die CVs 257 bis 264, für
Ausgang B die CVS 265 bis 272, für Ausgang C die CVS 273 bis 280, usw.

Die ersten vier Byte bezeichnen eine Funktion und Richtung. Dabei ist die Funktionsnummer
0 - 63 in den Bits 0 bis 6 abgelegt. Die Richtungsabhängigkeit wird in den Bits 6 und 7 wie
folgt definiert:

```
Bit
7
```
```
Bit
6
```
```
Rechenvorschrift Aktion
```
```
0 0 Funktionsnummer Funktion wirkt richtungsunabhängig
```
```
0 1 Funktionsnummer + 64 Funktion wirkt nur vorwärts
```
```
1 0 Funktionsnummer + 128 Funktion wirkt nur rückwärts
```
```
1 1 Funktionsnummer + 192
```
```
Funktion sperrt den Ausgang unabhängig vom
Zustand anderer Funktionen
```
Der Wert 255 kennzeichnet ein inaktives Byte.

Die zweiten vier Bytes enthalten zwei Byte-Paare, mit denen wahlweise Funktionen oder
Binärzustandssteuerungen ausgewählt werden können. Im ersten der beiden Bytes sind die
höherwertigen 7 Bits der Nummer von Funktion oder Binärzustandssteuerung, im zweiten
Byte die 8 niederwertigen Bits abgelegt. Nummern bis 28 einschließlich (ggf. anzupassen auf


68) bezeichnen Funktionen, Werte darüber bezeichnen Binärzustandssteuerungen. Das
höchstwertigste Bit (Bit 7) im ersten Byte wird gesetzt, wenn über diese Funktion oder
Binärzustandssteuerung der Ausgang gesperrt werden soll. Steuerungen über die beiden Byte-
Paare in den zweiten vier Bytes arbeiten immer richtungsunabhängig.

Haben beide Bytes eines Paares den Wert 255, so ist dieses Byte-Paar inaktiv.

Damit kann jeder der maximal 32 Ausgänge von bis zu sechs Funktionen oder Binärzuständen
bis Binärzustand 32767 gesteuert werden. Ein Sperren des Ausgangs über den Binärzustand
32767 ist nicht möglich. Auch gibt es keine Fahrtrichtungsabhängigkeit der Binärzustände.

Beispiel:
Lichtsteuerung an einer Diesel- oder E-Lok. Folgende Logik soll erreicht werden:

a. "normaler" Lichtwechsel über F
b. Weil das mit Zug nicht vorbildgerecht ist: F1 sperrt die Lichter an Führerstand 1, F2 sperrt
die Lichter an Führerstand 2.
c. Der Rangiergang über F6 soll auch beide weißen Lichter ein- und die roten Lichter
ausschalten.
d. Funktion F23 soll "Parklicht" mit rot auf beiden Seiten einschalten.

Programmierung:

a) b) c) d)

Ausgang weiß

1

#### CV257 =

#### F0 + 64 = 64

#### CV258 =

#### F1 + 192 = 193

#### CV259 =

#### F6 = 6

#### CV260 =

#### F23 + 192 = 215

Ausgang weiß
2

#### CV265 =

#### F0 + 128 = 128

#### CV266 =

#### F2 + 192 = 194

#### CV267 =

#### F6 = 6

#### CV268 =

#### F23 + 192 = 215

Ausgang rot 1

#### CV273 =

#### F0 + 128 = 128

#### CV274 =

#### F1 + 192 = 193

#### CV275 =

#### F6 + 192 = 198

#### CV275 =

#### F23 = 23

Ausgang rot 2

#### CV281 =

#### F0 + 64 = 64

#### CV282 =

#### F2 + 192 = 194

#### CV283 =

#### F6 + 192 = 198

#### CV284 =

#### F23 = 23

Die nicht aufgeführten CVs zwischen CV261 und CV288 haben den Wert 255.

Dabei ist zu sehen, dass es nur im ersten Byte eine Fahrtrichtungsabhängigkeit gibt. Problem:
Zum "Parken" muss der Rangiergang rausgenommen werden, sonst bleibt es duster. Ebenso
sollten F1 und F2 für Rangiergang und "Parklicht" ausgeschaltet werden. Diese Probleme
ließen sich lösen, indem ein Ausschalten nur auf die davor liegenden Bytes wirkt. Damit wäre
dann aber die Reihenfolge der Bytes nicht mehr beliebig.

## 4 Auswahl der Funktionszuordnung

Sind mehrere Systeme zur Funktionszuordnung in einem Decoder implementiert, so kann der
Anwender wie in [RCN225] festgelegt über die Konfigurationsvariable CV 96 das
gewünschte System auswählen.


## Anhang A: Verweise auf andere Normen

### A.1 Normative Verweise

Die hier aufgeführte Norme ist ganz oder in dem beim Zitat angegebenen Rahmen
einzuhalten, um diese Norm zu erfüllen.

[RCN225] RCN- 225 DCC Konfigurationsvariablen

### A.2 Informative Verweise

Die hier aufgeführten Normen und Dokumente haben rein informativen Charakter und sind
nicht Bestandteil dieser Norm.

## Anhang B: Historie

```
Datum Kapitel Änderungen gegenüber der jeweils vorhergehenden Version
```
02.12.2018 Alle Erste Version

Copyright 2018 RailCommunity – Verband der Hersteller Digitaler Modellbahnprodukte e.V.


