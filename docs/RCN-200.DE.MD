```
Norm
```
# RCN- 200

## Multiprotokollbetrieb

```
Verhalten von Decodern und Zentralen
```
```
Ausgabe
16.08.20 20
```
```
RailCommunity – Verband
der Hersteller Digitaler
Modellbahnprodukte e.V.
```
## Inhalt

1 Allgemeines ............................................................................................................................. 1

```
1.1 Zweck der Norm ........................................................................................................... 1
```
```
1.2 Anforderungen an Decoder ........................................................................................... 2
```
```
1.3 Anforderungen an Zentralen ......................................................................................... 2
```
2 Festlegung des Protokolls von Zubehördecodern ................................................................... 2

3 Einschaltverhalten von Fahrzeugdecodern .............................................................................. 3

4 Digitale Betriebsarten von Fahrzeugdecodern ........................................................................ 3

```
4.1 Erkennung der Protokolle ............................................................................................. 3
```
```
4.2 Auswahl des Protokolls beim Start ............................................................................... 3
4.3 Auswahl des Protokolls im Betrieb ............................................................................... 4
```
```
4.4 Mehrere Adressen ......................................................................................................... 4
```
5 Analoge Betriebsarten ............................................................................................................. 4

6 Übergänge zwischen den Betriebsarten .................................................................................. 5

7 Multiprotokollbetrieb von Zentralen ....................................................................................... 5

Anhang A: Verweise auf andere Normen .................................................................................. 6

```
A.1 Normative Verweise .................................................................................................... 6
```
```
A.2 Informative Verweise ................................................................................................... 6
```
Anhang B: Historie ..................................................................................................................... 6

## 1 Allgemeines

### 1.1 Zweck der Norm

Sehr viele Zentralen unterstützen mehrere Protokolle und senden diese zeitlich ineinander
verschachtelt. Jeder Decoder sollte in so einer Multiprotokollumgebung ein eindeutiges,
vorhersagbares Verhalten zeigen. Dieses gilt insbesondere dann, wenn er mehrere der von der
Zentrale gesendeten Protokolle unterstützt.

Des Weiteren muss der Übergang in eine analoge (also eine nicht über ein digitales Protokoll
gesteuerte) Betriebsart festen Regeln folgen. Dieser Teil ist eine deutlich erweiterte Version
des entsprechenden Abschnitts in [S-9.2.4] der NMRA.


Diese Norm legt fest, wie ein Decoder seine Betriebsart auswählt. Innerhalb dieser Norm
schließt der Begriff "Betriebsart" alle digitalen Protokolle und analogen Betriebsarten eines
Decoders ein.

Diese Norm definiert nicht die Bedingungen zum Erkennen eines Protokolls, wie ein Decoder
innerhalb eines Protokolls adressiert wird und wie innerhalb eines Protokolls zwischen
verschiedenen Modi – z.B. Betriebsmodus und Programmiermodus – umgeschaltet wird.
Diese Festlegungen sind in den Normen zu den Protokollen definiert.

### 1.2 Anforderungen an Decoder

Jeder Decoder muss alle folgenden Anforderungen erfüllen. Ausnahmen davon sind durch ein
"sollen" oder "können" gekennzeichnet.

Ein Decoder darf mehrere Protokolle und analoge Betriebsarten unterstützen. Es ist zulässig,
für jedes Protokoll eine andere Adresse zu konfigurieren.

Bei Protokollen mit blockweiser Adressierung wie Selectrix kann nicht sicher festgestellt
werden, ob der Decoder adressiert wurde. Daher hier sind Prioritäten für die unterstützen
Protokolle und Betriebsarten erforderlich, die in der Anleitung klar beschrieben sein müssen.

Unterstützte Protokolle und Betriebsarten können durch die Konfiguration gesperrt werden.
Beim DCC-Protokoll ist hierfür die in [RCN- 225 ] definierte CV 12 vorgesehen. Ist ein
Protokoll oder eine Betriebsart gesperrt, darf ein Decoder unabhängig von den folgenden
Festlegungen nicht auf dieses Protokoll reagieren bzw. in diese Betriebsart wechseln. Wird
jedoch ein gesperrtes aber unterstütztes digitales Protokoll erkannt, darf der Decoder nicht in
eine analoge Betriebsart wechseln.

Eine Ausnahme bilden Pakete der Programmiermodi, die auch bei gesperrtem zugehörigem
Protokoll verarbeitet werden dürfen. Dieses ist erforderlich, da nicht in allen Protokollen die
Konfigurationsmöglichkeiten bestehen, um das entsprechende Protokoll wieder freizugeben.

### 1.3 Anforderungen an Zentralen

Jede Zentrale muss alle folgenden Anforderungen erfüllen. Ausnahmen davon sind durch ein
"sollen" oder "können" gekennzeichnet.

## 2 Festlegung des Protokolls von Zubehördecodern

Ein Zubehördecoder muss immer auf alle freigegebenen Protokolle auf allen konfigurierten
Adressen reagieren.

Für eine feste Auswahl des Protokolls besteht das Problem, dass Zubehördecoder nicht
regelmäßig angesprochen werden. Daher ist grundsätzlich keine Auswahl vorgesehen,
sondern immer die Reaktion auf alle freigegebenen Protokolle.


## 3 Einschaltverhalten von Fahrzeugdecodern

Wenn Decoder Spannung erhalten, gibt es zwei Möglichkeiten:

1. Der spannungslose Zustand war nur kurz, so dass der Decoder noch gültige Informationen
    zu Geschwindigkeit, Richtung und der letzten Betriebsart hat. In diesem Fall darf er sofort
    den vorherigen Betrieb wieder aufnehmen. Hat sich das Protokoll am Gleis geändert,
    muss er diese Änderung genauso behandeln, als hätte es keine Unterbrechung der
    Stromzufuhr gegeben.
2. Der Decoder hat keine vollständigen Informationen mehr über den vorherigen
    Betriebszustand. Dann hat der Decoder die entsprechenden Vorgaben in [RCN- 530 ] und
    für den DCC-Programmiermodus [RCN- 216 ] einzuhalten.

Merkt sich der Decoder seinen Betriebszustand in einem nicht flüchtigen Speicher, so dass er
auch nach längerer Zeit noch seinen alten Betriebszustand kennt, so muss er eine andere
Vorrichtung haben, längere Spannungsausfälle zu erkennen und darf danach den alten
Betriebszustand nicht mehr verwenden.

## 4 Digitale Betriebsarten von Fahrzeugdecodern

### 4.1 Erkennung der Protokolle

Für die Erkennung der Protokolle sind je nach unterstützten Protokollen die folgenden
Normen einzuhalten: Für DCC [RCN- 210 ], [RCN- 211 ] sowie [RCN- 216 ] für den
Programmiermodus und sobald definiert für mfx® [RCN- 245 ], für Märklin Motorola [RCN-
265 ] und für Selectrix [RCN- 275 ]. Bei der Erkennung eines Protokolls muss die Richtigkeit
der Prüfsumme nicht geprüft werden.

### 4.2 Auswahl des Protokolls beim Start

Ist nur ein Protokoll freigegeben, so reagiert der Decoder nur auf dieses Protokoll und schaltet
beim Erkennen des Protokolls sofort in diese Betriebsart. Dieses gilt insbesondere für das
Selectrix-Protokoll, bei dem der Decoder sonst warten müsste, ob er anderweitig
angesprochen wird.

Ist mehr als ein Protokoll freigegeben und ist ein Vorzugsprotokoll konfiguriert, sollte er
immer dieses Protokoll auswählen, sobald er dieses Protokoll erkennt, unabhängig davon, ob
er über dieses Protokoll adressiert wird.

Wird das Vorzugsprotokoll nicht innerhalb einer vom Hersteller oder Anwender festgelegten
Zeit erkannt, so hat der Decoder sich so zu verhalten, als sei kein Vorzugsprotokoll festgelegt.

Ist kein Vorzugsprotokoll festgelegt, so sollte er auf das Protokoll reagieren, über das er als
erstes adressiert wird. Eine Ausnahme bildet das Selectrix-Protokoll, da dort immer alle
verfügbaren 112 Adressen angesprochen werden. Das Selectrix-Protokoll sollte der Decoder
erst auswählen, wenn er für mindestens 10 Sekunden nicht über ein anderes freigegebenes
Protokoll adressiert wird.


Solange er über kein Protokoll adressiert wird, darf der Decoder keinen Ausgang aktivieren
und den Motor nicht einschalten.

### 4.3 Auswahl des Protokolls im Betrieb

Ein Decoder darf nur dann von dem ausgewählten Protokoll auf ein anderes Protokoll
wechseln, wenn er für eine vom Hersteller oder Anwender festgelegte Zeit nicht mehr über
das ausgewählte Protokoll adressiert wurde oder das ausgewählte Protokoll nicht mehr
erkannt wird. In diesem Fall erfolgt die Auswahl der Betriebsart wie nach dem Anlegen der
Spannung. Der Hersteller kann die Zeit beliebig kurz definieren um einen spontanen Wechsel
zwischen den Protokollen zuzulassen. Dieses muss in der Anleitung klar beschrieben sein.

### 4.4 Mehrere Adressen

Kann ein Decoder auf mehrere Adressen eines Protokolls reagieren, so muss es dafür
Prioritäten oder Zuordnungen geben. Dabei können für jede Funktion (Motor,
Funktionsausgänge, Geräusche usw.) des Decoders getrennte Vorgaben festgelegt sein. Eine
einzelne Funktion eines Decoders darf dabei immer nur über eine Adresse gesteuert werden.
Für den Wechsel zwischen den Adressen gelten die gleichen Regeln wie für die Auswahl des
Protokolls.

Ein Beispiel für Zuordnungen von Funktionen auf Adressen ist die Mehrfachtraktion beim
DCC Protokoll. Fahrbefehle werden ausschließlich auf der Multitraktionsadresse,
Funktionsbefehle ggf. konfigurierbar über die Basis- oder Multitraktionsadresse und
Konfigurationsbefehle grundsätzlich nur über die Basisadresse empfangen.

## 5 Analoge Betriebsarten

Unterstützt ein Decoder eine analoge Betriebsart, so muss diese über eine Konfiguration
gesperrt werden können.

Die Auswahl einer analogen Betriebsart darf nur erfolgen, wenn keines der unterstützten
Protokolle erkannt wird. Zudem sollte entweder

 für mindestens 200 ms – oder die über die CV 11 eingestellte „Maximalzeit ohne
Datenempfang“ – eine Gleichspannung ohne Polaritätswechsel erkannt werden oder
 eine Wechselspannung mit Polaritätswechseln alle 7 bis 12 ms erkannt werden.

Waren diese Forderungen erfüllt und ist der Decoder in einer analogen Betriebsart, darf er
bei Unterstützung von DCC nur Funktionen aktivieren, die in den CVs 13 und 14 (siehe
[RCN- 225 ]) sowie weiteren herstellerspezifischen CVs für Funktionen oberhalb F12 aktiviert
sind. Diese Einstellung darf auch bei anderen Protokollen verwendet werden.

Im Analogbetrieb muss der Decoder beim Erkennen eines vom Decoder unterstützten
Protokolls sofort die analoge Betriebsart verlassen. Dieses gilt auch, wenn das Protokoll zwar
vom Decoder unterstützt wird aber nicht freigegeben ist.

Wird weder ein unterstütztes und freigegebenes Protokoll noch eine der genannten analogen
Spannungsformen erkannt, muss der Decoder alle an ihm angeschlossenen Verbraucher
abschalten.


## 6 Übergänge zwischen den Betriebsarten

Grundsätzlich sollten beim Wechsel der Betriebsart starke Geschwindigkeitssprünge und
spontane Richtungswechsel vermieden werden. Dazu werden die folgenden Regeln festgelegt.

Wechselt der Decoder in eine (andere) digitale Betriebsart, so hat er die bisherige
Geschwindigkeit und Richtung sowie den bisherigen Funktionsstatus beizubehalten, bis er
entsprechende Befehle in der neuen Betriebsart erhält.

Stimmt beim Wechsel der Betriebsart inklusive Wechsel des Protokolls die aufgrund der
neuen Betriebsart vorgegebene Fahrtrichtung mit der bisherigen überein, so hat der Decoder
mit der für die neue Betriebsart konfigurierten Anfahr- oder Bremsverzögerung die
Geschwindigkeit anzupassen – im Analogbetrieb soweit dieses aufgrund der zur Verfügung
stehenden Spannung möglich ist.

Stimmt beim Wechsel der Betriebsart inklusive Wechsel des Protokolls die aufgrund der
neuen Betriebsart vorgegebene Fahrtrichtung mit der bisherigen nicht überein, so richtet sich
die Geschwindigkeit nach der neuen Betriebsart aber der Decoder muss die bisherige
Fahrtrichtung beibehalten, bis das Fahrzeug im Digitalbetrieb durch einen entsprechenden
Befehl oder im Analogbetrieb durch Absenken der Spannung zum Stehen kommt. Danach
muss er wieder die Richtungsinformation der neuen Betriebsart beachten. Ansonsten gilt das
für eine übereinstimmende Fahrrichtung vorgegebene Verhalten.

## 7 Multiprotokollbetrieb von Zentralen

Die Zentrale hat dafür Sorge zu tragen, dass immer alle Vorgaben für alle gesendeten
Protokolle eingehalten werden. Das betrifft insbesondere die minimalen Wiederholraten.
Dadurch kann die Zahl der gleichzeitig gesendeten Protokolle begrenzt sein.

Eine Fahrzeugadresse darf immer nur über ein Protokoll angesprochen werden. Eine
Ausnahme bildet das Selectrix-Protokoll, bei dem die Adressen nicht einzeln angesprochen
werden können. Hier liegt es in der Verantwortung des Decoders entsprechend Abschnitt 4
das Protokoll auszuwählen.

Jede aktive Fahrzeugadresse muss mindestens alle 2,5 Sekunden angesprochen werden. Als
aktiv ist eine Fahrzeugadresse zu werten, bei der die Geschwindigkeit nicht 0 ist oder aus
anderen Gründen der Status in der Zentrale auf aktiv gehalten wird.

Werden Befehle für einen Programmiermodus erzeugt, dürfen nur Befehles dieses Protokolls
gesendet werden. Wird z.B. mit DCC-Rücksetzpaketen der DCC-Programmiermoduls
eingeleitet, dürfen bis zum Abschluss der Programmierung keine anderen Protokolle gesendet
werden. Befehle für eine Programmierung auf dem Hauptgleis sind von dieser Festlegung
nicht betroffen, d.h. sie dürfen auch in einer Multiprotokoll-Umgebung gesendet werden.

Zubehördecoder reagieren immer auf alle freigegeben Protokolle. Daher sollte jede
Zubehördecoderadresse nur in einem Protokoll angesprochen werden, um Störungen zu
vermeiden.


## Anhang A: Verweise auf andere Normen

### A.1 Normative Verweise

Die hier aufgeführten Normen sind für alle unterstützten Protokolle einzuhalten, um diese
Norm zu erfüllen.

[RCN-210] RCN- 210 DCC Bit-Übertragung

[RCN- 211 ] RCN- 211 DCC Paketstruktur und Adressbereiche

[RCN- 216 ] RCN- 216 DCC Programmierumgebung

[RCN-245] RCN- 245 mfx/M4 Übergänge der Betriebsarten 1

[RCN-265] RCN- 265 Motorola Übergänge der Betriebsarten 1

[RCN-275] RCN- 275 Selectrix Übergänge der Betriebsarten 1

[RCN- 530 ] RCN- 530 Einschaltstrom – Gleissignalverstärker - Decoder - Puffer

### A.2 Informative Verweise

Die hier aufgeführten Normen und Dokumente haben rein informativen Charakter und sind
nicht Bestandteil dieser Norm.

[RCN-225] RCN- 225 DCC Konfigurationsvariablen

[S-9.2.4] NMRA: S-9.2.4 DCC Fail Safe

## Anhang B: Historie

```
Datum Kapitel Änderungen seit der vorhergehenden Version
```
16. 08 .20 20 Alle Erste Version

Copyright 2020 RailCommunity – Verband der Hersteller Digitaler Modellbahnprodukte e.V.

(^1) Diese Norm gibt es noch nicht bzw. ist erst in Vorbereitung. Sobald es diese Norm gibt, gilt sie als normativ.


