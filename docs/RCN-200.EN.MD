# RCN-200

## Multi-Protocol Operation

```
Behavior of Decoders and Command Stations
```
```
Date of Issue
16.08.2020
```
```
RailCommunity – Association
of Digital Model Railroad
Product Manufacturers
```
## Contents

1 General ............................................................................................................................. 1

```
1.1 Purpose of the Standard ........................................................................................................... 1
1.2 Requirements for Decoders ........................................................................................... 2
1.3 Requirements for Command Stations ......................................................................................... 2
```
2 Defining the Protocol for Accessory Decoders ................................................................... 2

3 Power-On Behavior of Mobile Decoders .............................................................................. 3

4 Digital Operating Modes of Mobile Decoders ........................................................................ 3

```
4.1 Protocol Detection ............................................................................................. 3
4.2 Protocol Selection at Startup ............................................................................... 3
4.3 Protocol Selection During Operation ............................................................................... 4
4.4 Multiple Addresses ......................................................................................................... 4
```
5 Analog Operating Modes ............................................................................................................. 4

6 Transitions Between Operating Modes .................................................................................. 5

7 Multi-Protocol Operation of Command Stations ....................................................................................... 5

Appendix A: References to other Standards .................................................................................. 6

```
A.1 Normative References .................................................................................................... 6
A.2 Informative References ................................................................................................... 6
```
Appendix B: History ..................................................................................................................... 6

## 1 General

### 1.1 Purpose of the Standard

Many command stations support multiple protocols and transmit them interleaved in time.
Every decoder should exhibit a clear,
predictable behavior in such a multi-protocol environment. This is especially true if it supports several of the
protocols sent by the command station.

Furthermore, the transition to an analog (i.e., not controlled by a digital protocol)
operating mode must follow fixed rules. This part is a significantly expanded version
of the corresponding section in [S-9.2.4] of the NMRA.

This standard specifies how a decoder selects its operating mode. Within this standard,
the term "operating mode" includes all digital protocols and analog operating modes of a
decoder.

This standard does not define the conditions for detecting a protocol, how a decoder
is addressed within a protocol, and how to switch between
different modes within a protocol – e.g., operating mode and programming mode.
These specifications are defined in the standards for the respective protocols.

### 1.2 Requirements for Decoders

Every decoder must meet all the following requirements. Exceptions are indicated by
"should" or "may".

A decoder may support multiple protocols and analog operating modes. It is permissible
to configure a different address for each protocol.

For protocols with block-wise addressing like Selectrix, it cannot be reliably determined
whether the decoder has been addressed. Therefore, priorities for the supported
protocols and operating modes are necessary here, which must be clearly described in the manual.

Supported protocols and operating modes can be disabled through configuration.
For the DCC protocol, CV 12, as defined in [RCN-225], is intended for this purpose. If a
protocol or operating mode is disabled, a decoder must not react to this protocol or switch to this operating mode, regardless of the following
stipulations. However, if a disabled but supported digital protocol is detected, the decoder must not switch to
an analog operating mode.

An exception is packets for programming modes, which may be processed even if the associated
protocol is disabled. This is necessary because not all protocols have the
configuration options to re-enable the respective protocol.

### 1.3 Requirements for Command Stations

Every command station must meet all the following requirements. Exceptions are indicated by
"should" or "may".

## 2 Defining the Protocol for Accessory Decoders

An accessory decoder must always respond to all enabled protocols on all configured
addresses.

For a fixed selection of the protocol, the problem is that accessory decoders are not
addressed regularly. Therefore, no selection is generally provided;
instead, they always react to all enabled protocols.

## 3 Power-On Behavior of Mobile Decoders

When decoders receive power, there are two possibilities:

1.  The powerless state was brief, so the decoder still has valid information
    about speed, direction, and the last operating mode. In this case, it may immediately
    resume the previous operation. If the protocol on the track has changed,
    it must treat this change as if there had been no interruption of the
    power supply.
2.  The decoder no longer has complete information about the previous
    operating state. In this case, the decoder must comply with the corresponding specifications in [RCN-530] and
    for the DCC programming mode [RCN-216].

If the decoder remembers its operating state in non-volatile memory, so that it
still knows its old operating state even after a long time, it must have another
device to detect longer power failures and must not use the old
operating state afterwards.

## 4 Digital Operating Modes of Mobile Decoders

### 4.1 Protocol Detection

For protocol detection, the following
standards must be adhered to, depending on the supported protocols: For DCC [RCN-210], [RCN-211], and [RCN-216] for the
programming mode and, once defined, for mfx® [RCN-245], for Märklin Motorola [RCN-
265], and for Selectrix [RCN-275]. When detecting a protocol, the correctness
of the checksum does not need to be verified.

### 4.2 Protocol Selection at Startup

If only one protocol is enabled, the decoder only responds to this protocol and switches
to this operating mode immediately upon detecting the protocol. This applies in particular to the
Selectrix protocol, where the decoder would otherwise have to wait to see if it is
addressed by other means.

If more than one protocol is enabled and a preferred protocol is configured, it should
always select this protocol as soon as it detects it, regardless of whether
it is addressed via this protocol.

If the preferred protocol is not detected within a time specified by the manufacturer or user,
the decoder should behave as if no preferred protocol were set.

If no preferred protocol is set, it should respond to the protocol through which it is
first addressed. An exception is the Selectrix protocol, as all
available 112 addresses are always addressed. The decoder should only select the Selectrix protocol
if it is not addressed by another enabled
protocol for at least 10 seconds.

As long as it is not addressed by any protocol, the decoder must not activate any output
and must not turn on the motor.

### 4.3 Protocol Selection During Operation

A decoder may only switch from the selected protocol to another protocol
if it has not been addressed via the selected protocol for a time specified by the manufacturer or user,
or if the selected protocol is no longer
detected. In this case, the operating mode is selected as it would be after applying
power. The manufacturer can define the time to be arbitrarily short to allow a spontaneous switch
between protocols. This must be clearly described in the manual.

### 4.4 Multiple Addresses

If a decoder can respond to multiple addresses of a protocol, there must be
priorities or assignments for them. Separate specifications may be set for each function (motor,
function outputs, sounds, etc.) of the decoder.
A single function of a decoder may only be controlled by one address at a time.
The same rules apply to switching between addresses as to selecting the
protocol.

An example of assigning functions to addresses is the advanced consisting in the
DCC protocol. Drive commands are exclusively received on the consist address,
function commands may be configured to be received on the base or consist address, and
configuration commands are generally only received on the base address.

## 5 Analog Operating Modes

If a decoder supports an analog operating mode, it must be possible to disable it via a configuration.

The selection of an analog operating mode may only occur if none of the supported
protocols are detected. In addition, either

*   a DC voltage without polarity change should be detected for at least 200 ms – or the "Maximum time without
    data reception" set via CV 11 – or
*   an AC voltage with polarity changes every 7 to 12 ms should be detected.

If these requirements were met and the decoder is in an analog operating mode, it may
only activate functions, if DCC is supported, that are enabled in CVs 13 and 14 (see
[RCN-225]) and other manufacturer-specific CVs for functions above F12.
This setting may also be used for other protocols.

In analog mode, the decoder must immediately exit the analog operating mode upon detecting a
protocol supported by the decoder. This also applies if the protocol is
supported by the decoder but is not enabled.

If neither a supported and enabled protocol nor one of the mentioned analog
voltage forms is detected, the decoder must switch off all consumers
connected to it.

## 6 Transitions Between Operating Modes

In principle, sharp speed jumps and
spontaneous changes of direction should be avoided when changing the operating mode. For this purpose, the following rules are established.

If the decoder switches to a (different) digital operating mode, it must maintain the previous
speed and direction as well as the previous function status until it
receives corresponding commands in the new operating mode.

If, when changing the operating mode including a change of protocol, the
direction of travel specified by the new operating mode matches the previous one, the decoder
must adjust the speed with the start-up or braking delay configured for the new operating mode
– in analog mode, as far as this is possible given the available
voltage.

If, when changing the operating mode including a change of protocol, the
direction of travel specified by the new operating mode does not match the previous one, the
speed is determined by the new operating mode, but the decoder must maintain the previous
direction of travel until the vehicle comes to a stop in digital mode through a corresponding
command or in analog mode by reducing the voltage. After that,
it must again observe the direction information of the new operating mode. Otherwise, the
behavior specified for a matching direction of travel applies.

## 7 Multi-Protocol Operation of Command Stations

The command station must ensure that all specifications for all transmitted
protocols are always met. This particularly affects the minimum repetition rates.
This may limit the number of simultaneously transmitted protocols.

A vehicle address may only ever be addressed via one protocol. An
exception is the Selectrix protocol, where the addresses cannot be addressed individually.
Here, it is the responsibility of the decoder to select the protocol according to section 4.

Each active vehicle address must be addressed at least every 2.5 seconds. A
vehicle address is considered active if the speed is not 0 or if the
status in the command station is kept active for other reasons.

If commands for a programming mode are generated, only commands of this protocol
may be sent. If, for example, the DCC programming mode is
initiated with DCC reset packets, no other protocols may be sent until the programming is complete.
Commands for programming on the main track are not affected by this provision,
i.e., they may also be sent in a multi-protocol environment.

Accessory decoders always respond to all enabled protocols. Therefore, each
accessory decoder address should only be addressed in one protocol to avoid interference.

## Appendix A: References to other Standards

### A.1 Normative References

The standards listed here must be adhered to for all supported protocols to comply with this
standard.

[RCN-210] RCN-210 DCC Bit Transmission

[RCN-211] RCN-211 DCC Packet Structure and Address Ranges

[RCN-216] RCN-216 DCC Programming Environment

[RCN-245] RCN-245 mfx/M4 Transitions of Operating Modes 1

[RCN-265] RCN-265 Motorola Transitions of Operating Modes 1

[RCN-275] RCN-275 Selectrix Transitions of Operating Modes 1

[RCN-530] RCN-530 Inrush Current – Track Signal Amplifier - Decoder - Buffer

### A.2 Informative References

The standards and documents listed here are for informational purposes only and are
not part of this standard.

[RCN-225] RCN-225 DCC Configuration Variables

[S-9.2.4] NMRA: S-9.2.4 DCC Fail Safe

## Appendix B: History

```
Date Chapter Changes since the previous version
```
16.08.2020 All First version

Copyright 2020 RailCommunity – Association of Digital Model Railroad Product Manufacturers e.V.

(^1) This standard does not exist yet or is in preparation. As soon as this standard exists, it will be considered normative.
